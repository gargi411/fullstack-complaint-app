<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transport Complaint Management System</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- NAVIGATION BAR - DOM Concept: Structuring elements -->
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="logo">üöå Transport CMS</h1>
            <ul class="nav-menu">
                <li><a href="#home" class="nav-link active" data-page="home">Home</a></li>
                <li><a href="#about" class="nav-link" data-page="about">About</a></li>
                <li><a href="#contact" class="nav-link" data-page="contact">Contact</a></li>
                <li><a href="#dashboard" class="nav-link" data-page="dashboard">Dashboard</a></li>
            </ul>
        </div>
    </nav>

    <!-- HOME PAGE SECTION -->
    <section id="home" class="page active">
        <div class="container">
            <div class="hero">
                <h1>Welcome to Transport Complaint Management System</h1>
                <p>Your voice matters! Report issues with public transportation and help us improve our services.</p>
                
                <!-- STATISTICS SECTION - Using arrays and loops to display data -->
                <div class="stats-container">
                    <div class="stat-card">
                        <h2 id="total-complaints">0</h2>
                        <p>Total Complaints</p>
                    </div>
                    <div class="stat-card">
                        <h2 id="pending-complaints">0</h2>
                        <p>Pending</p>
                    </div>
                    <div class="stat-card">
                        <h2 id="inprogress-complaints">0</h2>
                        <p>In Progress</p>
                    </div>
                    <div class="stat-card">
                        <h2 id="resolved-complaints">0</h2>
                        <p>Resolved</p>
                    </div>
                </div>

                <!-- EVENT HANDLING - Button click event -->
                <button class="btn-primary" id="register-btn">üìù Register Complaint</button>
            </div>
        </div>
    </section>

    <!-- ABOUT PAGE SECTION -->
    <section id="about" class="page">
        <div class="container">
            <h1>About Us</h1>
            <div class="about-content">
                <p>The Transport Complaint Management System is designed to streamline the process of reporting and resolving transportation-related issues.</p>
                
                <h3>Our Mission</h3>
                <p>To provide a transparent and efficient platform for citizens to voice their concerns about public transportation services.</p>
                
                <h3>Features</h3>
                <ul>
                    <li>Easy complaint registration with unique tracking ID</li>
                    <li>Real-time status updates</li>
                    <li>Priority-based complaint handling</li>
                    <li>Location-based issue reporting</li>
                    <li>Comprehensive dashboard for tracking</li>
                </ul>

                <h3>How It Works</h3>
                <ol>
                    <li>Register your complaint with detailed information</li>
                    <li>Receive a unique complaint ID for tracking</li>
                    <li>Monitor status updates through the dashboard</li>
                    <li>Get resolution confirmation</li>
                </ol>
            </div>
        </div>
    </section>

    <!-- CONTACT PAGE SECTION -->
    <section id="contact" class="page">
        <div class="container">
            <h1>Contact Us</h1>
            <div class="contact-content">
                <div class="contact-info">
                    <h3>Get in Touch</h3>
                    <p><strong>üìß Email:</strong> support@transportcms.com</p>
                    <p><strong>üìû Phone:</strong> +91-8605719026</p>
                    <p><strong>üïí Working Hours:</strong> Mon-Sat, 9:00 AM - 6:00 PM</p>
                    <p><strong>üìç Address:</strong> Nagpur (East) - Bhandara Road RTO office at NIL or via email at mh49@mahatranscom.in</p>
                </div>
                
                <div class="emergency-info">
                    <h3>Emergency Contact</h3>
                    <p>For urgent safety concerns, please call: <strong>100</strong></p>
                </div>
            </div>
        </div>
    </section>

    <!-- DASHBOARD PAGE SECTION -->
    <section id="dashboard" class="page">
        <div class="container">
            <h1>Complaint Dashboard</h1>
            
            <!-- SEARCH AND FILTER - Event handling and conditions -->
            <div class="search-filter-container">
                <input type="text" id="search-input" placeholder="Search by ID, Name, or Route..." class="search-box">
                
                <select id="status-filter" class="filter-select">
                    <option value="all">All Status</option>
                    <option value="Pending">Pending</option>
                    <option value="In Progress">In Progress</option>
                    <option value="Resolved">Resolved</option>
                </select>

                <button class="btn-secondary" id="clear-filter-btn">Clear Filters</button>
            </div>

            <!-- COMPLAINTS LIST - DOM manipulation with arrays -->
            <div id="complaints-list" class="complaints-container">
                <p class="no-complaints">No complaints registered yet. Click "Register Complaint" to add one.</p>
            </div>
        </div>
    </section>

    <!-- COMPLAINT FORM MODAL - Conditional display -->
    <div id="complaint-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Register New Complaint</h2>
            
            <!-- FORM with validation - Events and conditions -->
            <form id="complaint-form">
                <div class="form-group">
                    <label for="full-name">Full Name *</label>
                    <input type="text" id="full-name" required>
                </div>

                <div class="form-group">
                    <label for="contact-number">Contact Number *</label>
                    <input type="tel" id="contact-number" pattern="[0-9]{10}" required>
                </div>

                <div class="form-group">
                    <label for="email">Email *</label>
                    <input type="email" id="email" required>
                </div>

                <div class="form-group">
                    <label for="route-number">Route Number / Bus Number *</label>
                    <input type="text" id="route-number" required>
                </div>

                <div class="form-group">
                    <label for="location">Location *</label>
                    <input type="text" id="location" required>
                </div>

                <div class="form-group">
                    <label for="complaint-type">Complaint Type *</label>
                    <select id="complaint-type" required>
                        <option value="">Select Type</option>
                        <option value="Delay">Delay</option>
                        <option value="Driver Behavior">Driver Behavior</option>
                        <option value="Safety">Safety</option>
                        <option value="Cleanliness">Cleanliness</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="description">Description *</label>
                    <textarea id="description" rows="4" required></textarea>
                </div>

                <div class="form-group">
                    <label for="priority">Priority *</label>
                    <select id="priority" required>
                        <option value="">Select Priority</option>
                        <option value="Low">Low</option>
                        <option value="Medium">Medium</option>
                        <option value="High">High</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="image-upload">Upload Image (Optional)</label>
                    <input type="file" id="image-upload" accept="image/*">
                    <small id="file-name" class="file-name-display"></small>
                </div>

                <div class="form-group">
                    <label>Set Location on Map (Optional)</label>
                    <div class="map-container">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect width='400' height='200' fill='%23e0e0e0'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%23666' font-size='16'%3EClick to Set Location%3C/text%3E%3C/svg%3E" alt="Map" id="map-image" class="map-image">
                        <span id="map-pin" class="map-pin"></span>
                    </div>
                    <p id="map-status" class="map-status">Click on the map to set location pin</p>
                </div>

                <button type="submit" class="btn-primary">Submit Complaint</button>
            </form>
        </div>
    </div>

    <style>
/* ===== CSS STYLING FOR PRINT-FRIENDLY DESIGN ===== */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Arial, sans-serif;
    background-color: #f5f5f5;
    color: #333;
    line-height: 1.6;
}

/* NAVIGATION */
.navbar {
    background-color: #fff;
    border-bottom: 2px solid #000;
    padding: 1rem 0;
    position: sticky;
    top: 0;
    z-index: 100;
}

.nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo {
    font-size: 1.5rem;
    font-weight: bold;
}

.nav-menu {
    display: flex;
    list-style: none;
    gap: 2rem;
}

.nav-link {
    text-decoration: none;
    color: #333;
    font-weight: 500;
    padding: 0.5rem 1rem;
    border: 2px solid transparent;
    transition: all 0.3s;
}

.nav-link:hover,
.nav-link.active {
    border-bottom: 2px solid #000;
}

/* CONTAINER */
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
}

/* PAGE SECTIONS */
.page {
    display: none;
    min-height: 80vh;
}

.page.active {
    display: block;
}

/* HERO SECTION */
.hero {
    text-align: center;
    padding: 3rem 0;
}

.hero h1 {
    font-size: 2.5rem;
    margin-bottom: 1rem;
}

.hero p {
    font-size: 1.2rem;
    color: #666;
    margin-bottom: 2rem;
}

/* STATISTICS */
.stats-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin: 2rem 0;
}

.stat-card {
    background: #fff;
    border: 2px solid #000;
    padding: 1.5rem;
    text-align: center;
}

.stat-card h2 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
}

.stat-card p {
    color: #666;
    font-weight: 500;
}

/* BUTTONS */
.btn-primary,
.btn-secondary {
    padding: 0.75rem 2rem;
    font-size: 1rem;
    border: 2px solid #000;
    background: #000;
    color: #fff;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-primary:hover {
    background: #fff;
    color: #000;
}

.btn-secondary {
    background: #fff;
    color: #000;
}

.btn-secondary:hover {
    background: #000;
    color: #fff;
}

/* ABOUT & CONTACT PAGES */
.about-content,
.contact-content {
    background: #fff;
    padding: 2rem;
    border: 1px solid #ddd;
}

.about-content h3,
.contact-content h3 {
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
    border-bottom: 2px solid #000;
    padding-bottom: 0.5rem;
}

.about-content ul,
.about-content ol {
    margin-left: 2rem;
    margin-top: 0.5rem;
}

.about-content li {
    margin-bottom: 0.5rem;
}

.contact-info,
.emergency-info {
    margin-bottom: 2rem;
}

.contact-info p,
.emergency-info p {
    margin: 0.5rem 0;
}

/* SEARCH AND FILTER */
.search-filter-container {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
}

.search-box,
.filter-select {
    padding: 0.75rem;
    border: 2px solid #000;
    font-size: 1rem;
    flex: 1;
    min-width: 200px;
}

/* COMPLAINTS LIST */
.complaints-container {
    display: grid;
    gap: 1rem;
}

.complaint-card {
    background: #fff;
    border: 2px solid #000;
    padding: 1.5rem;
}

.complaint-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.complaint-id {
    font-weight: bold;
    font-size: 1.1rem;
}

.status-badge {
    padding: 0.25rem 1rem;
    border: 2px solid #000;
    font-size: 0.9rem;
    font-weight: bold;
}

.status-badge.pending {
    background: #fff;
    color: #000;
}

.status-badge.in-progress {
    background: #d3d3d3;
    color: #000;
}

.status-badge.resolved {
    background: #000;
    color: #fff;
}

.complaint-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 0.5rem;
    margin: 1rem 0;
    padding: 1rem;
    background: #f9f9f9;
    border: 1px solid #ddd;
}

.detail-item {
    display: flex;
    gap: 0.5rem;
}

.detail-label {
    font-weight: bold;
}

.complaint-actions {
    display: flex;
    gap: 0.5rem;
    margin-top: 1rem;
    flex-wrap: wrap;
}

.action-btn {
    padding: 0.5rem 1rem;
    border: 2px solid #000;
    background: #fff;
    cursor: pointer;
    font-size: 0.9rem;
}

.action-btn:hover {
    background: #000;
    color: #fff;
}

.no-complaints {
    text-align: center;
    padding: 2rem;
    color: #666;
}

/* MODAL */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    overflow: auto;
}

.modal.show {
    display: block;
}

.modal-content {
    background-color: #fff;
    margin: 2% auto;
    padding: 2rem;
    border: 2px solid #000;
    width: 90%;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
}

.close-btn {
    color: #000;
    float: right;
    font-size: 2rem;
    font-weight: bold;
    cursor: pointer;
    line-height: 1;
}

.close-btn:hover {
    color: #666;
}

/* FORM */
.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: bold;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid #000;
    font-size: 1rem;
    font-family: Arial, sans-serif;
}

.form-group textarea {
    resize: vertical;
}

.file-name-display {
    display: block;
    margin-top: 0.5rem;
    color: #666;
    font-style: italic;
}

/* MAP */
.map-container {
    position: relative;
    border: 2px solid #000;
    cursor: crosshair;
    display: block;
    width: 100%;
    max-width: 400px;
}

.map-image {
    display: block;
    width: 100%;
    height: 200px;
    object-fit: cover;
}

.map-pin {
    position: absolute;
    font-size: 2rem;
    display: none;
    transform: translate(-50%, -100%);
    pointer-events: none;
    z-index: 10;
}

.map-pin.show {
    display: block;
}

.map-status {
    margin-top: 0.5rem;
    font-size: 0.9rem;
    color: #666;
}

/* PRINT STYLES */
@media print {
    .navbar,
    .btn-primary,
    .btn-secondary,
    .complaint-actions,
    .search-filter-container {
        display: none;
    }

    .page {
        display: block !important;
        page-break-after: always;
    }

    .modal {
        display: none !important;
    }
}
    </style>

    <script>
/* ---------- Backend endpoints ---------- */
const API_BASE = 'http://localhost:5000/api/complaints';

/* ---------- Keep existing DOM references ---------- */
const registerBtn = document.getElementById('register-btn');
const complaintModal = document.getElementById('complaint-modal');
const closeBtn = document.querySelector('.close-btn');
const complaintForm = document.getElementById('complaint-form');
const navLinks = document.querySelectorAll('.nav-link');
const pages = document.querySelectorAll('.page');
const complaintsList = document.getElementById('complaints-list');
const searchInput = document.getElementById('search-input');
const statusFilter = document.getElementById('status-filter');
const clearFilterBtn = document.getElementById('clear-filter-btn');
const imageUpload = document.getElementById('image-upload');
const fileName = document.getElementById('file-name');
const mapImage = document.getElementById('map-image');
const mapPin = document.getElementById('map-pin');
const mapStatus = document.getElementById('map-status');

/* ---------- Local state (kept for UI + offline fallback) ---------- */
let complaints = []; // will be replaced by server data on load
let mapPinSet = false;
let mapCoordinates = { x: 0, y: 0 };

/* ---------- Helpers ---------- */
function getCurrentTimestamp() {
  return new Date().toLocaleString('en-IN', {
    year: 'numeric', month: 'short', day: '2-digit',
    hour: '2-digit', minute: '2-digit'
  });
}

/* ---------- Backend: create complaint (multipart/form-data including image) ---------- */
async function postComplaintToServer(complaintData) {
  try {
    const fd = new FormData();
    // fields expected by backend:
    fd.append('fullName', complaintData.fullName);
    fd.append('contactNumber', complaintData.contactNumber);
    fd.append('email', complaintData.email);
    fd.append('routeNumber', complaintData.routeNumber);
    fd.append('location', complaintData.location);
    fd.append('complaintType', complaintData.complaintType);
    fd.append('description', complaintData.description);
    fd.append('priority', complaintData.priority);
    fd.append('timestamp', complaintData.timestamp || getCurrentTimestamp());
    fd.append('mapPin', complaintData.mapPin ? 'true' : 'false');
    if (complaintData.mapCoordinates) fd.append('mapCoordinates', JSON.stringify(complaintData.mapCoordinates));
    if (complaintData.imageFile) fd.append('image', complaintData.imageFile);

    const res = await fetch(API_BASE, { method: 'POST', body: fd });
    return await res.json();
  } catch (err) {
    console.error('Network error posting complaint:', err);
    return { success: false, error: err.message || 'Network error' };
  }
}

/* ---------- Backend: load complaints ---------- */
async function loadFromServer() {
  try {
    const res = await fetch(API_BASE);
    const data = await res.json();
    if (data && data.success) {
      complaints = data.complaints || [];
      return true;
    } else {
      console.error('Server returned error while loading complaints:', data);
      return false;
    }
  } catch (err) {
    console.error('Failed to load complaints from server:', err);
    return false;
  }
}

/* ---------- UI: Update statistics ---------- */
function updateStatistics() {
  const total = complaints.length;
  const pending = complaints.filter(c => c.status === 'Pending').length;
  const inProgress = complaints.filter(c => c.status === 'In Progress').length;
  const resolved = complaints.filter(c => c.status === 'Resolved').length;

  document.getElementById('total-complaints').textContent = total;
  document.getElementById('pending-complaints').textContent = pending;
  document.getElementById('inprogress-complaints').textContent = inProgress;
  document.getElementById('resolved-complaints').textContent = resolved;
}

/* ---------- UI: Render complaints ---------- */
function displayComplaints(complaintsToDisplay) {
  if (!complaintsList) return;
  if (!complaintsToDisplay || complaintsToDisplay.length === 0) {
    complaintsList.innerHTML = '<p class="no-complaints">No complaints found.</p>';
    return;
  }

  complaintsList.innerHTML = '';
  for (let i = 0; i < complaintsToDisplay.length; i++) {
    const complaint = complaintsToDisplay[i];
    const card = document.createElement('div');
    card.className = 'complaint-card';

    let statusClass = 'pending';
    if (complaint.status === 'In Progress') statusClass = 'in-progress';
    else if (complaint.status === 'Resolved') statusClass = 'resolved';

    const imageHtml = complaint.imageUrl ? `<div style="margin-top:8px;"><img src="${complaint.imageUrl}" style="max-width:200px; max-height:120px;"></div>` : '';

    card.innerHTML = `
      <div class="complaint-header">
        <span class="complaint-id">${complaint.id}</span>
        <span class="status-badge ${statusClass}">${complaint.status}</span>
      </div>
      <div class="complaint-details">
        <div class="detail-item"><span class="detail-label">Name:</span><span>${complaint.fullName || ''}</span></div>
        <div class="detail-item"><span class="detail-label">Contact:</span><span>${complaint.contactNumber || ''}</span></div>
        <div class="detail-item"><span class="detail-label">Email:</span><span>${complaint.email || ''}</span></div>
        <div class="detail-item"><span class="detail-label">Route:</span><span>${complaint.routeNumber || ''}</span></div>
        <div class="detail-item"><span class="detail-label">Location:</span><span>${complaint.location || ''}</span></div>
        <div class="detail-item"><span class="detail-label">Type:</span><span>${complaint.complaintType || ''}</span></div>
        <div class="detail-item"><span class="detail-label">Priority:</span><span>${complaint.priority || ''}</span></div>
        <div class="detail-item"><span class="detail-label">Submitted:</span><span>${complaint.timestamp || ''}</span></div>
        ${complaint.mapPin ? `<div class="detail-item"><span class="detail-label">Map Pin:</span><span>üìç</span></div>` : ''}
        ${imageHtml}
        <div class="detail-item" style="grid-column: 1/-1;"><span class="detail-label">Description:</span><span>${complaint.description || ''}</span></div>
      </div>
      <div class="complaint-actions">
        <button class="action-btn" data-id="${complaint.id}" data-action="Pending">Mark Pending</button>
        <button class="action-btn" data-id="${complaint.id}" data-action="In Progress">Mark In Progress</button>
        <button class="action-btn" data-id="${complaint.id}" data-action="Resolved">Mark Resolved</button>
        <button class="action-btn delete" data-id="${complaint.id}">Delete</button>
      </div>
    `;

    complaintsList.appendChild(card);
  }

  // attach action listeners
  document.querySelectorAll('.action-btn').forEach(btn => {
    btn.addEventListener('click', async (e) => {
      const id = btn.getAttribute('data-id');
      const action = btn.getAttribute('data-action');
      if (action) await changeStatusOnServer(id, action);
      else if (btn.classList.contains('delete')) await deleteOnServer(id);
    });
  });
}

/* ---------- Status change and delete on server (unprotected routes assumed) ---------- */
async function changeStatusOnServer(id, newStatus) {
  try {
    const res = await fetch(`${API_BASE}/${id}/status`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ status: newStatus })
    });
    const data = await res.json();
    if (data.success) {
      // refresh local list
      await loadAndRender();
      alert(`Complaint ${id} status updated to ${newStatus}`);
    } else {
      alert('Failed to update status: ' + (data.error || 'unknown'));
      console.error(data);
    }
  } catch (err) {
    console.error('Error updating status:', err);
    alert('Network error while updating status.');
  }
}

async function deleteOnServer(id) {
  if (!confirm('Delete this complaint?')) return;
  try {
    const res = await fetch(`${API_BASE}/${id}`, { method: 'DELETE' });
    const data = await res.json();
    if (data.success) {
      await loadAndRender();
      alert('Complaint deleted');
    } else {
      alert('Failed to delete: ' + (data.error || 'unknown'));
    }
  } catch (err) {
    console.error('Error deleting:', err);
    alert('Network error while deleting.');
  }
}

/* ---------- Load complaints from server and then render ---------- */
async function loadAndRender() {
  const ok = await loadFromServer();
  if (!ok) {
    // if server load fails fall back to localStorage (graceful)
    const stored = localStorage.getItem('complaints');
    complaints = stored ? JSON.parse(stored) : [];
  }
  updateStatistics();
  displayComplaints(complaints);
}

/* ---------- Hook up navigation and modal UI (keeps your original behavior) ---------- */
navLinks.forEach(link => {
  link.addEventListener('click', function(e) {
    e.preventDefault();
    const pageName = this.getAttribute('data-page');
    navLinks.forEach(l => l.classList.remove('active'));
    pages.forEach(p => p.classList.remove('active'));
    this.classList.add('active');
    document.getElementById(pageName).classList.add('active');
  });
});

registerBtn.addEventListener('click', () => complaintModal.classList.add('show'));

closeBtn.addEventListener('click', () => {
  complaintModal.classList.remove('show');
  complaintForm.reset();
  fileName.textContent = '';
  mapPin.classList.remove('show');
  mapStatus.textContent = 'Click on the map to set location pin';
  mapPinSet = false;
});

window.addEventListener('click', (e) => {
  if (e.target === complaintModal) {
    complaintModal.classList.remove('show');
    complaintForm.reset();
    fileName.textContent = '';
    mapPin.classList.remove('show');
    mapStatus.textContent = 'Click on the map to set location pin';
    mapPinSet = false;
  }
});

/* ---------- File input display ---------- */
imageUpload.addEventListener('change', function () {
  if (this.files && this.files.length > 0) fileName.textContent = `Selected: ${this.files[0].name}`;
  else fileName.textContent = '';
});

/* ---------- Map pin click (keeps your original) ---------- */
mapImage.addEventListener('click', function (e) {
  const rect = this.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  mapCoordinates = { x, y };
  mapPinSet = true;
  mapPin.textContent = 'üìç';
  mapPin.style.left = x + 'px';
  mapPin.style.top = y + 'px';
  mapPin.classList.add('show');
  mapStatus.textContent = '‚úì Location pin set successfully!';
  mapStatus.style.color = '#000';
  mapStatus.style.fontWeight = 'bold';
});

/* ---------- Form submit: send to backend ---------- */
complaintForm.addEventListener('submit', async function (e) {
  e.preventDefault();

  // grab values using the ids in your HTML
  const fullName = document.getElementById('full-name').value.trim();
  const contactNumber = document.getElementById('contact-number').value.trim();
  const email = document.getElementById('email').value.trim();
  const routeNumber = document.getElementById('route-number').value.trim();
  const location = document.getElementById('location').value.trim();
  const complaintType = document.getElementById('complaint-type').value;
  const description = document.getElementById('description').value.trim();
  const priority = document.getElementById('priority').value;

  // validation (same as before)
  if (!fullName || !contactNumber || !email || !routeNumber || !location ||
      !complaintType || !description || !priority) {
    alert('Please fill all required fields!');
    return;
  }

  const imageFile = (imageUpload.files && imageUpload.files.length > 0) ? imageUpload.files[0] : null;

  const complaint = {
    fullName, contactNumber, email, routeNumber,
    location, complaintType, description, priority,
    imageFile,
    mapPin: mapPinSet,
    mapCoordinates: mapPinSet ? mapCoordinates : null,
    timestamp: getCurrentTimestamp()
  };

  // send to backend
  const result = await postComplaintToServer(complaint);

  if (result && result.success) {
    // success - refresh from server and UI
    await loadAndRender();
    // reset UI
    complaintModal.classList.remove('show');
    complaintForm.reset();
    fileName.textContent = '';
    mapPin.classList.remove('show');
    mapStatus.textContent = 'Click on the map to set location pin';
    mapStatus.style.color = '#666';
    mapStatus.style.fontWeight = 'normal';
    mapPinSet = false;

    alert(`‚úì Complaint registered successfully!\nComplaint ID: ${result.complaint.id}\nSave this ID for tracking.`);
    // show dashboard
    navLinks.forEach(l => l.classList.remove('active'));
    pages.forEach(p => p.classList.remove('active'));
    document.querySelector('[data-page="dashboard"]').classList.add('active');
    document.getElementById('dashboard').classList.add('active');
  } else {
    alert('Failed to submit complaint: ' + (result.error || 'server error'));
    console.error('Submit error:', result);
  }
});

/* ---------- Search & filter (client-side) ---------- */
function searchAndFilter() {
  const searchTerm = (searchInput.value || '').toLowerCase();
  const statusValue = statusFilter.value || 'all';
  const filtered = complaints.filter(c => {
    const matchesSearch = (c.id || '').toLowerCase().includes(searchTerm) ||
                          (c.fullName || '').toLowerCase().includes(searchTerm) ||
                          (c.routeNumber || '').toLowerCase().includes(searchTerm) ||
                          (c.location || '').toLowerCase().includes(searchTerm);
    const matchesStatus = statusValue === 'all' || (c.status === statusValue);
    return matchesSearch && matchesStatus;
  });
  displayComplaints(filtered);
}

searchInput.addEventListener('input', searchAndFilter);
statusFilter.addEventListener('change', searchAndFilter);
clearFilterBtn.addEventListener('click', function () {
  searchInput.value = '';
  statusFilter.value = 'all';
  displayComplaints(complaints);
});

/* ---------- Init on load ---------- */
window.addEventListener('DOMContentLoaded', async () => {
  await loadAndRender();
});

/* ---------- END SCRIPT ---------- */
</script>

</body>
</html>